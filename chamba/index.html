<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Creador de Velas Virtual en 3D</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #EBE8DB;
      padding: 20px;
      text-align: center;
      color: #3D0301;
    }

    h1 {
      color: #B03052;
      margin-bottom: 30px;
    }

    .game-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      max-width: 1200px;
      margin: 0 auto;
      gap: 20px;
    }

    .controls {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      min-width: 300px;
      border: 2px solid #D76C82;
    }

    .display {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      width: 600px;
      height: 600px;
      position: relative;
      border: 2px solid #D76C82;
    }

    canvas {
      width: 100% !important;
      height: 100% !important;
      display: block;
    }

    label, select, input[type="color"], input[type="text"], button {
      display: block;
      margin: 10px auto;
      font-size: 16px;
    }

    button {
      padding: 10px;
      background-color: #D76C82;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #B03052;
    }
  </style>
</head>
<body>
  <h1>CREA TU VELA 3D</h1>
  <div class="game-container">
    <div class="controls">
      <h2>Personalización</h2>
      <label for="color">Color de la vela</label>
      <input type="color" id="color" value="#ffffff">

      <label for="fragrance">Fragancia</label>
      <select id="fragrance">
        <option value="none">Ninguna</option>
        <option value="lavender">Lavanda</option>
        <option value="vanilla">Vainilla</option>
        <option value="cinnamon">Canela</option>
        <option value="rose">Rosa</option>
        <option value="ocean">Brisa Marina</option>
      </select>

      <label for="additive">Aditivo</label>
      <select id="additive">
        <option value="none">Ninguno</option>
        <option value="glitter">Purpurina</option>
        <option value="driedFlowers">Flores secas</option>
        <option value="seaShells">Conchas marinas</option>
      </select>

      <label for="phrase">Frase externa</label>
      <input type="text" id="phrase" placeholder="Escribe tu frase aquí">

      <label for="textColor">Color de la frase</label>
      <input type="color" id="textColor" value="#000000">

      <button id="generate">Crear / Actualizar Vela</button>
    </div>
    <div class="display" id="scene-container"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/FontLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/geometries/TextGeometry.js"></script>
  <script>
    let scene, camera, renderer, controls, candle;

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ antialias: true });

      const container = document.getElementById("scene-container");
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      camera.position.set(0, 1.5, 3);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(5, 10, 7.5);
      scene.add(light);

      const ambient = new THREE.AmbientLight(0x404040);
      scene.add(ambient);

      createCandle(document.getElementById("color").value);
      animate();
    }

    function createCandle(color) {
      if (candle) {
        scene.remove(candle);
      }

      const group = new THREE.Group();

      const bodyGeometry = new THREE.CylinderGeometry(0.5, 0.5, 2, 32);
      const bodyMaterial = new THREE.MeshPhongMaterial({ color });
      const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
      body.position.y = 1;
      group.add(body);

      const wickGeometry = new THREE.CylinderGeometry(0.02, 0.02, 0.2);
      const wickMaterial = new THREE.MeshBasicMaterial({ color: 0x222222 });
      const wick = new THREE.Mesh(wickGeometry, wickMaterial);
      wick.position.y = 2.1;
      group.add(wick);

      const additive = document.getElementById("additive").value;
      if (additive === "glitter") {
        const sparkleMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
        for (let i = 0; i < 100; i++) {
          const sparkle = new THREE.Mesh(new THREE.SphereGeometry(0.02), sparkleMaterial);
          sparkle.position.set(
            (Math.random() - 0.5) * 0.9,
            0.2 + Math.random() * 1.6,
            (Math.random() - 0.5) * 0.9
          );
          group.add(sparkle);
        }
      } else if (additive === "driedFlowers") {
        const flowerMaterial = new THREE.MeshBasicMaterial({ color: 0xffc0cb });
        for (let i = 0; i < 10; i++) {
          const petal = new THREE.Mesh(new THREE.SphereGeometry(0.1), flowerMaterial);
          petal.position.set(
            (Math.random() - 0.5) * 0.6,
            0.3 + Math.random() * 1.4,
            (Math.random() - 0.5) * 0.6
          );
          group.add(petal);
        }
      } else if (additive === "seaShells") {
        const shellMaterial = new THREE.MeshBasicMaterial({ color: 0xf5deb3 });
        for (let i = 0; i < 6; i++) {
          const shell = new THREE.Mesh(new THREE.SphereGeometry(0.08, 6, 6), shellMaterial);
          shell.position.set(
            (Math.random() - 0.5) * 0.6,
            0.3 + Math.random() * 1.4,
            (Math.random() - 0.5) * 0.6
          );
          group.add(shell);
        }
      }

      const phrase = document.getElementById("phrase").value;
      const textColor = document.getElementById("textColor").value;
      if (phrase) {
        const loader = new THREE.FontLoader();
        loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', function (font) {
          const textGeometry = new THREE.TextGeometry(phrase, {
            font: font,
            size: 0.08,
            height: 0.005,
            curveSegments: 12
          });
          const textMaterial = new THREE.MeshBasicMaterial({ color: new THREE.Color(textColor) });
          const textMesh = new THREE.Mesh(textGeometry, textMaterial);

          textMesh.position.set(-0.2, 1.2, 0.51); // Pegado como esticker
          textMesh.rotation.y = 0;
          group.add(textMesh);
        });
      }

      candle = group;
      scene.add(candle);
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    document.getElementById("generate").addEventListener("click", () => {
      const color = document.getElementById("color").value;
      createCandle(color);
    });

    window.addEventListener("resize", () => {
      const container = document.getElementById("scene-container");
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });

    init();
  </script>
</body>
</html>